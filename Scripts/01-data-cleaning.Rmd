---
# Insert YAML header for RMarkdown document
title: "Template RMarkdown File"
author: "Robert J. Dellinger"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
fontsize: 12pt
# Set the output format to PDF and preferences
output: # preferred output format
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: false
    fig_caption: true
    fig_width: 6
    fig_height: 4
    keep_tex: false
    latex_engine: xelatex
# Path to bib file to generate a bibliography
bibliography: "References/references.bib"
# Path to CSL file for citation style (APA)
csl: "references/apa.csl"  
cache: false  
# nocite: '@*'  # Include all references
header-includes:
  # Set page margins and spacing 
  - \setlength{\headheight}{14.5pt}
  - \addtolength{\topmargin}{-2.5pt}
  - \usepackage{geometry}
  - \geometry{left=1in, right=1in, top=1in, bottom=1in}
  - \usepackage{setspace}
  - \doublespacing
  # Enable fancy headers and footers
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  # Centered page header 
  - \fancyhead[L]{}  
  - \fancyhead[C]{Template RMarkdown File} 
  - \fancyhead[R]{} 
  # Page numbering in the footer
  - \fancyfoot[L]{}  
  - \fancyfoot[C]{\thepage} 
  - \fancyfoot[R]{}  
  # Reduce header rule thickness 
  #- \renewcommand{\headrulewidth}{0.2pt}
 # - \renewcommand{\footrulewidth}{0pt} 
---

```{r setup, include=FALSE}

# Set up the environment and clear the workspace
rm(list = ls())

# Install pacman as package manager to automatically install/update packages
if (!requireNamespace("pacman", quietly = TRUE)) install.packages("pacman")
library(pacman)

# Load/install essential packages
p_load(# packages for data manipulation and wrangling
    tidyverse, stringr, readr, readxl, dplyr, tidyr, janitor, lubridate, glue, purrr, here,
    # packages for data visualization and reporting
    ggplot2, gganimate, ggrepel, ggtext, scales, kableExtra, cowplot, patchwork, plotly, 
    # packages for spatial data analysis and visualization
    sf, tigris, raster, ggmap,
    # packages for statistical analysis
    knitr, rmarkdown, sessioninfo, 
    # packages for formatting, reproducibility and version control
    devtools, remotes, knitcitations, tinytex
)

# Define output + cache paths
output_path_images <- here("Output", "Figures")
output_path_tables <- here("Output", "Tables")

# Chunk options
knitr::opts_chunk$set(
  echo = TRUE,
  cache = TRUE,
  fig.path = paste0(output_path_images, "/Fig-"),
  fig.align = "center",
  out.width = "100%",
  dpi = 600
)

```

# Introduction

This document outlines the methodology for data cleaning, exploration, and visualization. It is structured to ensure transparency and reproducibility of all analyses.

## Methodology

Briefly describe the methods used in the project, including data sources, cleaning steps, and techniques applied to handle missing or inconsistent data.

### Math Equations with LaTeX

Here is an inline equation: \( E = mc^2 \).

And here is a displayed equation:

\[
f(x) = \int_{-\infty}^{\infty} e^{-x^2} \, dx
\]

Both inline and block math can be rendered seamlessly with LaTeX.

You can also create multiline equations with alignment:

\[
\begin{aligned}
a &= b + c \\
d &= e + f
\end{aligned}
\]

## Loading Data

The first step in any data analysis is to load the data. This section outlines the process of importing the data into R, including any necessary transformations or adjustments to ensure compatibility with the analysis.


```{r load-data}

# Example of loading data from a CSV file
# raw_data <- read_csv(here("Data", "Raw", "data_file.csv"))
# raw_data <- read_excel(here("Data", "Raw", "data_file.xlsx"))

```

## Cleaning Data 

The data cleaning process involves several steps to ensure the data is in a suitable format for analysis. This includes handling missing values, correcting data types, and removing duplicates.

```{r wrangle-data}

# Example of cleaning data
# - Removing duplicates
# - Handling missing values
# - Converting data types and cleaning white space
# - Renaming columns, etc.

# cleaned_data <- raw_data %>%
#   clean_names() %>%
#   mutate(column_name = as_factor(column_name)) %>% 
#   mutate(date_column = as.Date(date_column, format = "%Y-%m-%d")) %>% # convert to date
#   mutate(numeric_column = as.numeric(numeric_column)) %>% # convert to numeric
#   mutate(accross(everything(), ~str_squish(.))) %>% # clean whitespace
#   drop_na()

```

## Data Exploration

Data exploration is a crucial step in understanding the dataset and identifying patterns or anomalies. This section includes summary statistics, visualizations, and any other relevant analyses to gain insights into the data.


```{r data-exploration}

# Explore the cleaned data using basic summaries:
# glimpse(cleaned_data)
# summary(cleaned_data)
# str(cleaned_data)

```

## Data Visualization

Data visualization is an essential part of data analysis, allowing for the communication of findings in a clear and effective manner. This section includes various plots and charts to illustrate key insights from the data.


```{r data-visualization-table, fig.cap="Example of a scatter plot"}

# Example of creating a summary table 
# summary_table <- cleaned_data %>%
#   group_by(group_var) %>%
#   summarise(mean_value = mean(value_var, na.rm = TRUE)) %>%
#   ungroup() %>%
#   kable() %>%
#   kable_styling(full_width = F, position = "left") 

# save_kable(summary_table, file = here(output_path_tables, "summary_table.html"),
#   bootstrap_options = c("striped", "hover", "condensed"),
#   full_width = F, position = "left")


```


```{r data-visualization-plot, fig.cap="Example of a scatter plot"}

# Example of visualization plot
# ggplot(cleaned_data, aes(x = var1, y = var2)) +
#   geom_point() +
#   theme_minimal()

# Example of saving a plot
# ggsave(filename = here(output_path_images, "plot_name.png"), plot = last_plot(), width = 6, height = 4)

```

# Literature Cited

Citing the packages and data used in the analysis is important for reproducibility and transparency. The following code generates a bibliography of all loaded packages. Items can be cited directly within the documentation using the syntax `@key` where key is the citation key in the first line of the entry, e.g., @R-base, @R-ggplot2, @R-tidyverse, @R-here. To put citations in parentheses, use `[@key]` instead. 


```{r literature-cited, echo=FALSE, include=FALSE}

# Site packages and data used here 
# Generate citations for loaded packages
knitr::write_bib(.packages(), here("Scripts", "References", "references.bib"))
bib_file <- here("Scripts", "References", "references.bib")
# Read the bib file
bib <- readLines(bib_file)

# Generate a session info report
sessioninfo <- sessioninfo::session_info()
#print(sessioninfo[1]$platform %>% as_tibble())

# Save session info to a CSV file
write.csv(sessioninfo[1]$platform %>% as_tibble(), here("Docs", "References", "session_info.csv"))
write.csv(sessioninfo[2]$package %>% as_tibble(), here("Docs", "References", "session_info_packages.csv"))

```


